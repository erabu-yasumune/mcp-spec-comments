# 実装ルール

## コメント形式の理解
このプロジェクトでは以下の形式でコメントが記述されています:

```
// @spec-impl[状態:TODO|IN_PROGRESS|DONE][優先度:高|中|低][実装順序:数値]
// [実装内容の説明]
//
// 実装要件:
// [要件を箇条書きで記述]
//
// 実装例:
// [具体的な実装手順を擬似コード形式で記述]
// @spec-end
```

## 実装方針

### 1. マーカーの発見
- `@spec-impl` マーカーを見つけたら、そこに実装を行う
- マーカーの位置を変更しない
- 複数のマーカーがある場合は **実装順序** の数値順に実装する
- 優先度（高・中・低）も考慮するが、基本は実装順序に従う

### 2. コメントの解釈
- **実装要件**: 満たすべき条件を確認
- **実装例**: 擬似コード形式の手順に忠実に実装
- コメントの内容に忠実に実装する
- 不明点があれば設計書を参照する

### 3. 実装の配置
- `@spec-impl` と `@spec-end` の間にコードを書く
- コメントは残す（削除しない）
- 実装完了後は状態を `DONE` に更新する

### 4. 状態の更新
実装開始時:
```
// @spec-impl[状態:IN_PROGRESS][優先度:高][実装順序:1]
```

実装完了後:
```
// @spec-impl[状態:DONE][優先度:高][実装順序:1]
```

## 実装パターン

### 基本的な流れ

1. **コメントを読む**: `@spec-impl` から `@spec-end` までの内容を確認
2. **実装要件をチェック**: 満たすべき条件を理解
3. **実装例に従う**: 擬似コードの手順通りに実装
4. **コードを書く**: マーカーの間に実際のコードを書く
5. **状態を更新**: 完了したら `状態:DONE` に変更

### 実装前（TODO）

```typescript
// @spec-impl[状態:TODO][優先度:高][実装順序:1]
// ユーザー認証処理を実装
//
// 実装要件:
// 1. トークンを検証する
// 2. 無効なら null を返す
// 3. 有効ならユーザー情報を返す
//
// 実装例:
// authenticateUser関数を作る
//   トークンが空なら
//     エラーを投げる
//   トークンを検証する
//   検証結果を返す
// @spec-end
```

### 実装後（DONE）

```typescript
// @spec-impl[状態:DONE][優先度:高][実装順序:1]
// ユーザー認証処理を実装
//
// 実装要件:
// 1. トークンを検証する
// 2. 無効なら null を返す
// 3. 有効ならユーザー情報を返す
//
// 実装例:
// authenticateUser関数を作る
//   トークンが空なら
//     エラーを投げる
//   トークンを検証する
//   検証結果を返す
export function authenticateUser(token: string): User | null {
  if (!token) throw new Error('Token is required');
  const decoded = jwt.verify(token, SECRET_KEY);
  return decoded ? (decoded as User) : null;
}
// @spec-end
```

**ポイント**:
- コメントは削除せず残す
- `状態:TODO` を `状態:DONE` に変更する
- 実装コードはマーカーの間に書く

## 品質基準

### コードスタイル
- プロジェクトの既存コードスタイルに従う
- TypeScriptの場合は型定義を必ず追加
- ESLint/Prettierの設定があれば従う

### エラーハンドリング
- 適切な例外処理を実装
- エラーメッセージは明確にする
- 必要に応じてログを出力

### テスト
- 可能な限りユニットテストを作成
- エッジケースをカバー
- テストコードも `@spec-impl` マーカーの一部として管理可能

## 注意事項
- **コメントを削除しない** - 実装後も履歴として残す
- **マーカーの位置を変更しない** - 元の位置で実装する
- **他のファイルに影響を与えない** - 変更は最小限に
- **一度に複数のマーカーを実装しない** - 1つずつ確実に実装
- **状態更新を忘れない** - 完了したら必ず `DONE` に更新
